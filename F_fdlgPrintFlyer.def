Version =20
VersionRequired =20
Checksum =2108296696
Begin Form
    AutoResize = NotDefault
    RecordSelectors = NotDefault
    AutoCenter = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    DefaultView =0
    ScrollBars =0
    ViewsAllowed =1
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    Width =7920
    DatasheetFontHeight =10
    ItemSuffix =24
    Left =7170
    Top =480
    Right =15330
    Bottom =6120
    DatasheetGridlinesColor =12632256
    RecSrcDt = Begin
        0x5591bc860f48e240
    End
    Caption ="Print Flyer"
    DatasheetFontName ="Arial"
    PrtMip = Begin
        0xa0050000a0050000a0050000a005000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    PrtDevMode = Begin
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x01043c079c00d006134f0100010009009a0b3408640001000f00580202000100 ,
        0x0000030000004134000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000050524956 ,
        0xe012000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000180000000000102710271027 ,
        0x0000102700000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000
    End
    PrtDevNames = Begin
        0x08001b002e000100000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000446f6375436f6d2050444620506f72743a00
    End
    Begin
        Begin Label
            BackStyle =0
        End
        Begin CommandButton
            FontSize =8
            FontWeight =400
            ForeColor =-2147483630
            FontName ="MS Sans Serif"
        End
        Begin TextBox
            SpecialEffect =2
            OldBorderStyle =0
        End
        Begin ListBox
            SpecialEffect =2
        End
        Begin FormHeader
            Height =0
            BackColor =-2147483633
            Name ="FormHeader"
        End
        Begin Section
            Height =4860
            BackColor =-2147483633
            Name ="Detail"
            Begin
                Begin Label
                    SpecialEffect =4
                    OldBorderStyle =1
                    BorderWidth =3
                    OverlapFlags =85
                    TextAlign =2
                    Left =2160
                    Top =60
                    Width =2880
                    Height =420
                    FontSize =12
                    FontWeight =700
                    Name ="Label1"
                    Caption ="Print Flyer"
                End
                Begin Tab
                    OverlapFlags =85
                    Left =60
                    Top =600
                    Width =7815
                    Height =4215
                    Name ="TabCtl5"
                    Begin
                        Begin Page
                            OverlapFlags =215
                            Left =195
                            Top =1005
                            Width =7545
                            Height =3675
                            Name ="Page6"
                            Caption ="Print Selected Groups"
                            Begin
                                Begin ListBox
                                    OverlapFlags =247
                                    MultiSelect =2
                                    ColumnCount =4
                                    Left =240
                                    Top =1260
                                    Width =6600
                                    Height =3420
                                    Name ="lstGroups"
                                    RowSourceType ="Table/Query"
                                    RowSource ="SELECT tblSubscr.SUBgroupID, tblGrp.GRname, Count(tblSubscr.SUBssn) AS GrpCount,"
                                        " Sum(IIf(IsNull([SUBflyerPRTdte]),0,1)) AS Printed FROM (tblGrp INNER JOIN tblSu"
                                        "bscr ON tblGrp.GROUPid = tblSubscr.SUBgroupID) INNER JOIN tblRates ON tblSubscr."
                                        "RateID = tblRates.RateID GROUP BY tblSubscr.SUBgroupID, tblGrp.GRname, tblSubscr"
                                        ".SUBstatus, tblGrp.GRcancelled, tblRates.Rate HAVING (((tblSubscr.SUBstatus)=\"G"
                                        "RSUB\") AND ((tblGrp.GRcancelled)=False) AND ((tblRates.Rate)=0));"
                                    ColumnWidths ="720;4320;720;720"
                                    AfterUpdate ="[Event Procedure]"
                                End
                                Begin CommandButton
                                    OverlapFlags =215
                                    Left =6960
                                    Top =1320
                                    Width =780
                                    Height =1020
                                    TabIndex =1
                                    Name ="cmdPrint"
                                    Caption ="Print All in Selected Groups"
                                    OnClick ="[Event Procedure]"
                                End
                                Begin TextBox
                                    Visible = NotDefault
                                    OverlapFlags =223
                                    Left =3720
                                    Top =2520
                                    Width =3900
                                    Height =555
                                    TabIndex =2
                                    BackColor =10092543
                                    Name ="txtSelectedGrpID"
                                End
                                Begin CommandButton
                                    OverlapFlags =215
                                    Left =6960
                                    Top =4200
                                    Width =780
                                    Height =420
                                    TabIndex =3
                                    Name ="cmdClear"
                                    Caption ="Reset"
                                    OnClick ="[Event Procedure]"
                                End
                                Begin Label
                                    OverlapFlags =215
                                    Left =240
                                    Top =1020
                                    Width =780
                                    Height =210
                                    Name ="Label13"
                                    Caption ="Group ID"
                                End
                                Begin Label
                                    OverlapFlags =215
                                    Left =1140
                                    Top =1020
                                    Width =1680
                                    Height =210
                                    Name ="Label14"
                                    Caption ="Group Name"
                                End
                                Begin Label
                                    OverlapFlags =215
                                    Left =5280
                                    Top =1020
                                    Width =600
                                    Height =210
                                    Name ="Label15"
                                    Caption ="Count"
                                End
                                Begin Label
                                    OverlapFlags =223
                                    Left =240
                                    Top =3875
                                    Width =600
                                    Height =210
                                    Name ="Label16"
                                    Caption ="Count"
                                End
                                Begin Label
                                    OverlapFlags =223
                                    Left =240
                                    Top =3875
                                    Width =600
                                    Height =210
                                    Name ="Label17"
                                    Caption ="Count"
                                End
                                Begin Label
                                    OverlapFlags =215
                                    Left =6000
                                    Top =1020
                                    Width =720
                                    Height =210
                                    Name ="Label18"
                                    Caption ="Printed"
                                End
                                Begin CommandButton
                                    OverlapFlags =247
                                    Left =6960
                                    Top =2400
                                    Width =780
                                    Height =960
                                    TabIndex =4
                                    Name ="cmdPrintNew"
                                    Caption ="Print New in Selected Groups"
                                    OnClick ="[Event Procedure]"
                                End
                            End
                        End
                        Begin Page
                            OverlapFlags =247
                            Left =195
                            Top =1005
                            Width =7545
                            Height =3675
                            Name ="Page7"
                            Caption ="Print All groups"
                            Begin
                                Begin CommandButton
                                    OverlapFlags =247
                                    Left =1260
                                    Top =1620
                                    Width =1380
                                    Height =540
                                    Name ="cmdPrintAll"
                                    Caption ="Print All "
                                    OnClick ="[Event Procedure]"
                                End
                                Begin CommandButton
                                    OverlapFlags =247
                                    Left =1260
                                    Top =2340
                                    Width =1380
                                    Height =540
                                    TabIndex =1
                                    Name ="cmdPrintAllNew"
                                    Caption ="Print New"
                                    OnClick ="[Event Procedure]"
                                End
                            End
                        End
                    End
                End
            End
        End
        Begin FormFooter
            Height =540
            BackColor =-2147483633
            Name ="FormFooter"
            Begin
                Begin CommandButton
                    OverlapFlags =85
                    Left =7140
                    Top =60
                    Width =726
                    Height =426
                    Name ="cmdClose"
                    Caption ="Command0"
                    OnClick ="[Event Procedure]"
                    PictureData = Begin
                        0x2800000010000000100000000100040000000000800000000000000000000000 ,
                        0x0000000000000000000000000000800000800000008080008000000080008000 ,
                        0x8080000080808000c0c0c0000000ff00c0c0c00000ffff00ff000000c0c0c000 ,
                        0xffff0000ffffff00dadad0dadadadadaadad00adadadadaddad030dadadadada ,
                        0xad0330adadadadad0033300000000adaa03330ff0dadadadd03300ff0adad4da ,
                        0xa03330ff0dad44add03330ff0ad44444a03330ff0d444444d03330ff0ad44444 ,
                        0xa0330fff0dad44add030ffff0adad4daa00fffff0dadadadd00000000adadada ,
                        0xadadadadadadadad000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x000000000000000000000000000000000000000000000000
                    End
                    ObjectPalette = Begin
                        0x0003100000000000800000000080000080800000000080008000800000808000 ,
                        0x80808000c0c0c000ff000000c0c0c000ffff00000000ff00c0c0c00000ffff00 ,
                        0xffffff0000000000
                    End
                    ControlTipText ="Close Form"
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Private Sub cmdClear_Click()
    With Me
        .lstGroups.Value = -1
        .txtSelectedGrpID = ""
    End With
End Sub

Private Sub cmdClose_Click()
On Error GoTo Err_cmdClose_Click


    DoCmd.Close

Exit_cmdClose_Click:
    Exit Sub

Err_cmdClose_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_cmdClose_Click
    
End Sub
Private Sub cmdPrint_Click()
On Error GoTo Err_cmdPrint_Click

    Dim stDocName As String
    Dim strInClause As String
    Dim strCriteria As String
    
    strInClause = Me.txtSelectedGrpID

    strCriteria = "(tblSubscr." & strInClause & ""
    
    ' Mark all Zero as printed
    Dim dbs As DAO.Database
    Dim strSQL As String
    Dim rst As DAO.Recordset
    Dim lngCnt As Long
    Dim lngAns As Long
    
    Set dbs = CurrentDb()
    
    strSQL = "SELECT Count(tblSubscr.SUBssn) AS GrpCount " & _
        "FROM tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
        "INNER JOIN tblRates ON tblSubscr.RateID = tblRates.RateID" & _
        "WHERE (((tblSubscr." & strInClause & ")) " & _
        "GROUP BY tblSubscr.SUBstatus, tblGrp.GRcancelled, tblRates.Rate " & _
        "HAVING (((tblSubscr.SUBstatus)='GRSUB') AND ((tblGrp.GRcancelled)=False) AND ((tblRates.Rate)=0));"
    Set rst = dbs.OpenRecordset(strSQL, dbOpenSnapshot)
    If rst.RecordCount > 0 Then
        lngCnt = rst.Fields("GrpCount")
        lngAns = MsgBox("Please load the printer with " & lngCnt & " flyers and press OK to print", vbOKCancel, "Print Labels")
        rst.Close
    End If
    
    If lngAns = vbOK Then
        ' Print the Lables
        stDocName = "rptZeroBalance_Label"
        'DoCmd.OpenReport stDocName, acViewPreview, , strCriteria
        
        DoCmd.OpenReport stDocName, acNormal, , strCriteria
        
        strSQL = "UPDATE tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
            "SET tblSubscr.SUBflyerPRTdte = Now() " & _
            "WHERE (((tblSubscr." & strInClause & "));"
        dbs.Execute strSQL, dbSeeChanges
    End If
    
    Set dbs = Nothing
    
Exit_cmdPrint_Click:
    Exit Sub

Err_cmdPrint_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_cmdPrint_Click
    
End Sub

Private Sub cmdPrintAll_Click()
On Error GoTo Err_cmdPrint_Click

    Dim stDocName As String
    
    ' Mark all Zero as printed
    Dim dbs As DAO.Database
    Dim strSQL As String
    Dim rst As DAO.Recordset
    Dim lngCnt As Long
    Dim lngAns As Long
    
    Set dbs = CurrentDb()
    
    strSQL = "SELECT Count(tblSubscr.SUBssn) AS GrpCount " & _
        "FROM tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
        "INNER JOIN tblRates ON tblSubscr.RateID = tblRates.RateID" & _
        "GROUP BY tblSubscr.SUBstatus, tblGrp.GRcancelled, tblRates.Rate " & _
        "HAVING (((tblSubscr.SUBstatus)='GRSUB') AND ((tblGrp.GRcancelled)=False) AND ((tblRates.Rate)=0));"
    Set rst = dbs.OpenRecordset(strSQL, dbOpenSnapshot)
    If rst.RecordCount > 0 Then
        lngCnt = rst.Fields("GrpCount")
        lngAns = MsgBox("Please load the printer with " & lngCnt & " flyers and press OK to print", vbOKCancel, "Print Labels")
        rst.Close
    End If
    
    If lngAns = vbOK Then
        ' Print the Lables
        stDocName = "rptZeroBalance_Label"
        DoCmd.OpenReport stDocName, acNormal
        
        strSQL = "UPDATE tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
            "SET tblSubscr.SUBflyerPRTdte = Now(); "
        dbs.Execute strSQL, dbSeeChanges
    End If
    
    Set dbs = Nothing
    
Exit_cmdPrint_Click:
    Exit Sub

Err_cmdPrint_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_cmdPrint_Click
End Sub

Private Sub cmdPrintAllNew_Click()
On Error GoTo Err_cmdPrint_Click

    Dim stDocName As String

    ' Mark all Zero as printed
    Dim dbs As DAO.Database
    Dim strSQL As String
    Dim rst As DAO.Recordset
    Dim lngCnt As Long
    Dim lngAns As Long
    
    Set dbs = CurrentDb()
    
    strSQL = "SELECT Count(tblSubscr.SUBssn) AS GrpCount, tblSubscr.SUBflyerPRTdte " & _
        "FROM tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
        "INNER JOIN tblRates ON tblSubscr.RateID = tblRates.RateID" & _
        "GROUP BY tblSubscr.SUBflyerPRTdte, tblSubscr.SUBstatus, tblGrp.GRcancelled, tblRates.Rate " & _
        "HAVING (((tblSubscr.SUBflyerPRTdte) Is Null) AND ((tblSubscr.SUBstatus)='GRSUB') AND ((tblGrp.GRcancelled)=False) AND ((tblRates.Rate)=0));"
    Set rst = dbs.OpenRecordset(strSQL, dbOpenSnapshot)
    If rst.RecordCount > 0 Then
        lngCnt = rst.Fields("GrpCount")
        lngAns = MsgBox("Please load the printer with " & lngCnt & " flyers and press OK to print", vbOKCancel, "Print Labels")
        rst.Close
    End If
    
    If lngAns = vbOK Then
        ' Print the Lables
        stDocName = "rptZeroBalanceNew_Label"
        DoCmd.OpenReport stDocName, acNormal
        
        strSQL = "UPDATE tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
            "SET tblSubscr.SUBflyerPRTdte = Now(); "
        dbs.Execute strSQL, dbSeeChanges
    End If
    
    Set dbs = Nothing
    
Exit_cmdPrint_Click:
    Exit Sub

Err_cmdPrint_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_cmdPrint_Click
End Sub

Private Sub cmdPrintNew_Click()
On Error GoTo Err_cmdPrint_Click

    Dim stDocName As String
    Dim strInClause As String
    Dim strCriteria As String
    
    strInClause = Me.txtSelectedGrpID
    
    strCriteria = "(tblSubscr." & strInClause & ""

    ' Mark all Zero as printed
    Dim dbs As DAO.Database
    Dim strSQL As String
    Dim rst As DAO.Recordset
    Dim lngCnt As Long
    Dim lngAns As Long
  
    Set dbs = CurrentDb()
    
    strSQL = "SELECT Count(tblSubscr.SUBssn) AS GrpCount, tblSubscr.SUBflyerPRTdte " & _
        "FROM tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
        "INNER JOIN tblRates ON tblSubscr.RateID = tblRates.RateID" & _
        "WHERE (((tblSubscr." & strInClause & ")) " & _
        "GROUP BY tblSubscr.SUBflyerPRTdte, tblSubscr.SUBstatus, tblGrp.GRcancelled, tblRates.Rate " & _
        "HAVING (((tblSubscr.SUBflyerPRTdte) Is Null) AND ((tblSubscr.SUBstatus)='GRSUB') AND ((tblGrp.GRcancelled)=False) AND ((tblRates.Rate)=0));"
    Set rst = dbs.OpenRecordset(strSQL, dbOpenSnapshot)
    If rst.RecordCount > 0 Then
        lngCnt = rst.Fields("GrpCount")
        lngAns = MsgBox("Please load the printer with " & lngCnt & " flyers and press OK to print", vbOKCancel, "Print Labels")
        rst.Close
    End If
    
    If lngAns = vbOK Then
        ' Print the Lables
        stDocName = "rptZeroBalanceNew_Label"
        'DoCmd.OpenReport stDocName, acViewPreview, , strCriteria
        
        DoCmd.OpenReport stDocName, acNormal, , strCriteria
        
        strSQL = "UPDATE tblGrp INNER JOIN tblSubscr ON tblGrp.GroupID = tblSubscr.SUBgroupID " & _
            "SET tblSubscr.SUBflyerPRTdte = Now() " & _
            "WHERE (((tblSubscr." & strInClause & "));"
        dbs.Execute strSQL, dbSeeChanges
    End If
    
    Set dbs = Nothing
    
Exit_cmdPrint_Click:
    Exit Sub

Err_cmdPrint_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_cmdPrint_Click
    
End Sub

Private Sub lstGroups_AfterUpdate()
    
    Dim strInClause As String
    Dim strGrpIDs As String
    Dim varItem As Variant
    Dim frm As Form, ctl As Control
    Dim intI As Integer

    
    'First, make sure something is selected
    If Me.lstGroups.ItemsSelected.Count = 0 Then
      Exit Sub
    End If
    
    'Cycle through the ItemsSelected
    '  and build a comma-delimited list
    '  of the values in the bound column
    With Me.lstGroups
        For Each varItem In .ItemsSelected
            strInClause = strInClause & ", '" & .ItemData(varItem) & "'"
        Next varItem
    End With
    
    Set frm = Forms!fdlgPrintFlyer
    Set ctl = frm!lstGroups
    For Each varItem In ctl.ItemsSelected
           strGrpIDs = strGrpIDs & ", " & ctl.Column(1, varItem)
    Next varItem
    
    'Strip off the leading ", "
    strInClause = Mid(strInClause, 3)
    strGrpIDs = Mid(strGrpIDs, 3)
        
    'Complete the syntax
    strInClause = "SUBgroupID) In(" & strInClause & ")"
       
    Me.txtSelectedGrpID = strInClause
    
End Sub