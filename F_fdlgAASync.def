Version =20
VersionRequired =20
Checksum =1069896015
Begin Form
    Modal = NotDefault
    RecordSelectors = NotDefault
    MaxButton = NotDefault
    ShortcutMenu = NotDefault
    AutoCenter = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    DefaultView =0
    ScrollBars =0
    ViewsAllowed =1
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    Width =5595
    DatasheetFontHeight =10
    ItemSuffix =36
    Left =7785
    Top =240
    Right =14025
    Bottom =7230
    DatasheetGridlinesColor =12632256
    RecSrcDt = Begin
        0xf4f15965d3a0e240
    End
    GUID = Begin
        0x0554ddec2772d64dba0317421853a882
    End
    NameMap = Begin
        0x0acc0e5500000000000000000000000000000000000000000c00000003000000 ,
        0x0000000000000000000000000000
    End
    Caption ="All American Sync"
    MenuBar ="Dialog"
    DatasheetFontName ="Arial"
    PrtMip = Begin
        0xa0050000a0050000a0050000a005000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    PrtDevMode = Begin
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x010400069c00fc0253ef800101000100ea0a6f08640001000f00b00402000100 ,
        0xb004030001004c65747465720000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000010000000000000001000000 ,
        0x0200000001000000ffffffff0000000000000000000000000000000044494e55 ,
        0x2200c000fc020000ac13d8c00000000000000000000000000000000000000000 ,
        0x0000000000000000050000000000070000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000010000000000000000000000c0000000534d544a ,
        0x000000001000b000530065006e006400200074006f0020004d00690063007200 ,
        0x6f0073006f006600740020004f006e0065004e006f0074006500200031003500 ,
        0x20004400720069007600650072000000524553444c4c00556e69726573444c4c ,
        0x00506170657253697a65004c4554544552004f7269656e746174696f6e00504f ,
        0x525452414954005265736f6c7574696f6e0044504936303000436f6c6f724d6f ,
        0x646500323462707000000000000000000000000000000000
    End
    PrtDevNames = Begin
        0x08002c0041000100000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x006e756c3a00
    End
    AllowDatasheetView =0
    AllowPivotTableView =0
    AllowPivotChartView =0
    AllowPivotChartView =0
    Begin
        Begin Label
            BackStyle =0
        End
        Begin Rectangle
            SpecialEffect =3
            BackStyle =0
        End
        Begin CommandButton
            FontSize =8
            FontWeight =400
            ForeColor =-2147483630
            FontName ="MS Sans Serif"
        End
        Begin Section
            Height =5970
            BackColor =-2147483633
            Name ="Detail"
            GUID = Begin
                0xabc4dba7a8c6924c91e9f2e9eb819125
            End
            Begin
                Begin Label
                    SpecialEffect =4
                    OldBorderStyle =1
                    BorderWidth =3
                    OverlapFlags =85
                    TextAlign =2
                    Left =1236
                    Top =132
                    Width =3120
                    Height =360
                    FontSize =12
                    FontWeight =700
                    Name ="Label0"
                    Caption ="All American Sync"
                    GUID = Begin
                        0xb0ad5154dbd015468009dc3e1eb4434c
                    End
                End
                Begin CommandButton
                    OverlapFlags =93
                    Left =1872
                    Top =732
                    Width =1620
                    Height =432
                    Name ="cmdProcess"
                    Caption ="Process Groups"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x8767761193dd8f499c8db71bac79a1be
                    End
                End
                Begin CommandButton
                    OverlapFlags =93
                    Left =1770
                    Top =4005
                    Width =288
                    Height =288
                    TabIndex =1
                    Name ="cmdPrint"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x73a35e8f4079134386dc1174717d1eb8
                    End
                    Begin
                        Begin Label
                            OverlapFlags =93
                            Left =2058
                            Top =4005
                            Width =1656
                            Height =300
                            Name ="Label26"
                            Caption ="Cards Review"
                            GUID = Begin
                                0xc3ee0e5575017c44bba27a4fc1a53726
                            End
                        End
                    End
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =1890
                    Top =4815
                    Width =1620
                    Height =432
                    TabIndex =2
                    Name ="cmdImport"
                    Caption ="Import New"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x38db9a29cf13c34f9a50c7f13247ae81
                    End
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =2418
                    Top =5400
                    Width =432
                    Height =432
                    TabIndex =3
                    Name ="cmdClose"
                    Caption ="Command4"
                    OnClick ="[Event Procedure]"
                    PictureData = Begin
                        0x2800000010000000100000000100040000000000800000000000000000000000 ,
                        0x0000000000000000000000000000800000800000008080008000000080008000 ,
                        0x8080000080808000c0c0c0000000ff00c0c0c00000ffff00ff000000c0c0c000 ,
                        0xffff0000ffffff00dadad0dadadadadaadad00adadadadaddad030dadadadada ,
                        0xad0330adadadadad0033300000000adaa03330ff0dadadadd03300ff0adad4da ,
                        0xa03330ff0dad44add03330ff0ad44444a03330ff0d444444d03330ff0ad44444 ,
                        0xa0330fff0dad44add030ffff0adad4daa00fffff0dadadadd00000000adadada ,
                        0xadadadadadadadad000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000
                    End
                    ObjectPalette = Begin
                        0x000301000000000000000000
                    End
                    ControlTipText ="Close Form"
                    GUID = Begin
                        0xae0533939c20f4469625decd36abba6e
                    End
                End
                Begin CommandButton
                    OverlapFlags =93
                    Left =1770
                    Top =3705
                    Width =288
                    Height =288
                    TabIndex =4
                    Name ="cmdViewChanges"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x027b4a308d4a9d4f91fb228dfc06fd4d
                    End
                    Begin
                        Begin Label
                            OverlapFlags =95
                            Left =2058
                            Top =3705
                            Width =1656
                            Height =300
                            Name ="Label24"
                            Caption ="View Changed Details"
                            GUID = Begin
                                0x8a12f7dc2632ad40b82b515d20b7a795
                            End
                        End
                    End
                End
                Begin Rectangle
                    OverlapFlags =223
                    Left =768
                    Top =612
                    Width =4020
                    Height =4083
                    Name ="Box7"
                    GUID = Begin
                        0x225bcf7333ce85419573c805493db154
                    End
                End
                Begin CommandButton
                    OverlapFlags =215
                    Left =1872
                    Top =1634
                    Width =1620
                    Height =432
                    TabIndex =5
                    Name ="btnTPA_Bad_Plan_and_Rate"
                    Caption ="Fix Plans and Covers"
                    OnClick ="[Event Procedure]"
                    ObjectPalette = Begin
                        0x0003100000000000800000000080000080800000000080008000800000808000 ,
                        0x80808000c0c0c000ff000000c0c0c000ffff00000000ff00c0c0c00000ffff00 ,
                        0xffffff0000000000
                    End
                    ControlTipText ="Open Form"
                    GUID = Begin
                        0x96e7c40db2677d4cbf3a406ad199f256
                    End
                End
                Begin CommandButton
                    OverlapFlags =223
                    Left =1770
                    Top =3105
                    Width =288
                    Height =288
                    TabIndex =6
                    Name ="cmdAdditions"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x9d75fb7a5266c94d8ccf63c7524baaff
                    End
                    Begin
                        Begin Label
                            OverlapFlags =223
                            Left =2058
                            Top =3105
                            Width =1656
                            Height =300
                            Name ="Label25"
                            Caption ="Additions"
                            GUID = Begin
                                0x2f6914ca2cd5274fa006c48cbbd90a50
                            End
                        End
                    End
                End
                Begin Rectangle
                    OverlapFlags =223
                    Left =1125
                    Top =2205
                    Width =3420
                    Height =2280
                    Name ="Box22"
                    GUID = Begin
                        0x1a88d9fa3f94d24fb202f655b9a604f9
                    End
                End
                Begin Label
                    SpecialEffect =4
                    OldBorderStyle =1
                    BorderWidth =3
                    OverlapFlags =215
                    TextAlign =2
                    Left =1887
                    Top =2265
                    Width =1620
                    Height =432
                    Name ="Label23"
                    Caption ="Reports"
                    GUID = Begin
                        0x650cf270773d1e4dbc06c7cc1fabe5e3
                    End
                End
                Begin CommandButton
                    OverlapFlags =215
                    Left =1770
                    Top =3405
                    Width =288
                    Height =288
                    TabIndex =7
                    Name ="cmdDrops"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x11c0d605c0768d46b808fe8c2f1fb1f8
                    End
                    Begin
                        Begin Label
                            OverlapFlags =215
                            Left =2058
                            Top =3405
                            Width =1656
                            Height =300
                            Name ="Label30"
                            Caption ="Drops"
                            GUID = Begin
                                0xa64acabdb4ebf049a335603aa773aa5c
                            End
                        End
                    End
                End
                Begin CommandButton
                    OverlapFlags =215
                    Left =1770
                    Top =2805
                    Width =288
                    Height =288
                    TabIndex =8
                    Name ="cmdStatistics"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0xc48e7d8b11086449a43312ad5a6c0b2d
                    End
                    Begin
                        Begin Label
                            OverlapFlags =215
                            Left =2058
                            Top =2805
                            Width =1656
                            Height =300
                            Name ="Label32"
                            Caption ="Statistics"
                            GUID = Begin
                                0x81a57bc8bd0f094aa2e9366c681946fa
                            End
                        End
                    End
                End
                Begin CommandButton
                    OverlapFlags =215
                    Left =1872
                    Top =1183
                    Width =1620
                    Height =432
                    TabIndex =9
                    Name ="btnDupSSNs"
                    Caption ="Fix Dup SSNs"
                    OnClick ="[Event Procedure]"
                    ControlTipText ="Open Form"
                    GUID = Begin
                        0xbb8ea188e7038d4d971e7a58fb7eebca
                    End
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit
Dim mstrSQL As String
Dim mstrUser As String
Dim mstrPath As String
Dim mstrFileName As String
'-------------------------------------------------
' Object:           fdlgAASync
' Purpose:          processes data from tpa
'
' Change log:
' Date          Version     Developer       Comments
' 2007-01-01    1.0         T Cook          Created
' 2015-10-27    2.0         J Criswell      Changed design of form
'                                           to process data from new tpa

Private Function PickFile() As String

    On Error GoTo FUNC_ERR
    
    Dim strFile As String
    Dim clsFileDialog As CFileDialog
   
   ' creates a common file dialog object
    Set clsFileDialog = New CFileDialog
    With clsFileDialog
        ' Use the GetFileName method to Display the file open dialog
        ' and retrieve the file name
        ' This method accepts parameters rather than requiring
        ' the class properties to be set.
        strFile = .GetFileName(True, "*.csv", "", "CSV files (*.csv)|Text files (*.txt)|*.txt|All Files (*.*)|*.*")
        
        ' make sure that it's a file
        If IsNull(strFile) Then
            MsgBox "You cancelled the File Open dialog"
            GoTo FUNC_EXIT
        End If
    
        ' set common file dialog properties
        .DefaultExt = "csv"
        .DialogTitle = "Import tpa file!"
        .InitialDir = "\\dc\datafiles\Clients\Direct Care Administrators\QCD Export File\"
        .Filter = "CSV files (*.csv)|Text files (*.txt)|*.txt|All files (*.*)|*.*"
        .FilterIndex = 0
        .Flags = FleFileMustExist + FleHideReadOnly + FleCreatePrompt
        .hWndParent = 0 'Use your form's .hwnd property if available
        .MaxFileSize = 255
        mstrPath = .InitialDir
    End With
    
    If Not IsNull(strFile) And strFile <> "" Then
        PickFile = Replace(strFile, "F:\", "\\dc\datafiles\")
    Else
        PickFile = ""
        MsgBox "User cancelled", vbExclamation, "QCD: Pick file"
    End If
    
    Set clsFileDialog = Nothing
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
FUNC_EXIT:
  DoCmd.SetWarnings True
  DoCmd.Hourglass False
  Exit Function
  
FUNC_ERR:
  MsgBox "Error: (" & Err.Number & ") " & Err.DESCRIPTION, vbCritical, "Function:fdlgAASync.PickFile"
  Resume FUNC_EXIT
  
End Function

Private Function Run_Procedure(strSQL As String, strUserName As String, strPath As String, strFileName As String) As Integer

On Error GoTo PROC_ERR
    
    If g_adoConnection.STATE = adStateOpen Then g_adoConnection.Close
    With g_adoConnection
         .ConnectionString = SetConnxn
         .CommandTimeout = 300
         .Open
    End With
    
    With g_adoCommand
          .ActiveConnection = g_adoConnection
          .CommandTimeout = 300
          .CommandType = adCmdStoredProc
          .CommandText = strSQL
          
          Set g_adoParm = .CreateParameter("Return", adInteger, adParamReturnValue) 'Return parm
          .Parameters.Append g_adoParm
          
          Set g_adoParm = .CreateParameter("@User", adVarChar, adParamInput, 50)
          .Parameters.Append g_adoParm
          .Parameters("@User").Value = strUserName
          
          Set g_adoParm = .CreateParameter("@Path", adVarChar, adParamInput, 100)
          .Parameters.Append g_adoParm
          .Parameters("@Path").Value = strPath
          
          Set g_adoParm = .CreateParameter("@File", adVarChar, adParamInput, 50)
          .Parameters.Append g_adoParm
          .Parameters("@File").Value = strFileName
          
          .Execute
    End With
    
    g_iRtnVal = g_adoCommand(0)
    g_adoConnection.Close
  
    Set g_adoCommand = Nothing
    Set g_adoConnection = Nothing
    Set g_adoParm = Nothing
    
    Run_Procedure = g_iRtnVal
    
PROC_EXIT:
  DoCmd.SetWarnings True
  DoCmd.Hourglass False
  Exit Function
    
    
PROC_ERR:
  MsgBox "Error: (" & Err.Number & ") " & Err.DESCRIPTION, vbCritical, " Function:Form_fdlgAASync.Import"
  Resume PROC_EXIT
    
End Function

Private Sub btnDupSSNs_Click()

    On Error GoTo Err_btnDupSSNs_Click

    Dim db As DAO.Database
    Dim rst As DAO.Recordset
    Dim stDocName As String
    
    Set db = CurrentDb()
    Set rst = db.OpenRecordset("vw_tpa_dup_ssn", dbOpenSnapshot)
    If rst.BOF And rst.EOF Then
        MsgBox "There are no duplicate SSNs.", vbOKOnly, "QCD: Dup SSNs."
    Else
        ' open form to fix problems
         stDocName = "frmTPA_DupSSNs"
         DoCmd.OpenForm stDocName, acFormDS, , , acFormEdit, acWindowNormal
    End If
    
    rst.Close
    Set db = Nothing
        
Exit_btnDupSSNs_Click:
    Exit Sub

Err_btnDupSSNs_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_btnDupSSNs_Click
    
End Sub

'-------------------------------------------------


Private Sub cmdAdditions_Click()
    ' Comments   :    Report with all new subscribers
    '                   and dependents from the tpa file
    ' Parameters hh
    ' Created    :    2015-10-26  J Criswell
    ' Modified   :
    '
    '
    '
    ' --------------------------------------------------------
  On Error GoTo PROC_ERR
    
    ' validation
    If ValidSSN And ValidPlanCover Then
            gintProcessStatus = 1
    Else
        If ValidSSN Then
            gintProcessStatus = ValidSSN
        Else
            gintProcessStatus = 0
        End If
        
        If ValidPlanCover Then
            gintProcessStatus = ValidPlanCover
        Else
            gintProcessStatus = 0
        End If
    End If
    
    ' process data
    If gintProcessStatus <> 1 Then
        MsgBox "You must process the data first.  Click " & vbCrLf & _
                "'Process Groups' button to process the data! ", vbCritical, _
                "Data Not Processed"
        gintProcessStatus = 0
    GoTo PROC_EXIT
    End If

    
    DoCmd.Hourglass True
    DoCmd.SetWarnings False
    
    DoCmd.OpenReport "Additions", acViewPreview
    gintProcessStatus = 1
   
    
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
PROC_EXIT:
    Exit Sub

PROC_ERR:
    MsgBox Err.DESCRIPTION
    Resume PROC_EXIT

End Sub

Private Sub cmdDrops_Click()

    ' Comments   :    Report with all dropped subscribers
    '                   and dependents from the tpa file
    ' Parameters :
    ' Created    :    2015-10-26  J Criswell
    ' Modified   :
    '
    '
    '
    ' --------------------------------------------------------
  On Error GoTo PROC_ERR
    
    ' validation
    If ValidSSN And ValidPlanCover Then
            gintProcessStatus = 1
    Else
        If ValidSSN Then
            gintProcessStatus = ValidSSN
        Else
            gintProcessStatus = 0
        End If
        
        If ValidPlanCover Then
            gintProcessStatus = ValidPlanCover
        Else
            gintProcessStatus = 0
        End If
    End If
    
    ' process data
    If gintProcessStatus <> 1 Then
        MsgBox "You must process the data first.  Click " & vbCrLf & _
                "'Process Groups' button to process the data! ", vbCritical, _
                "Data Not Processed"
        gintProcessStatus = 0
        GoTo PROC_EXIT
    End If
    
    DoCmd.Hourglass True
    DoCmd.SetWarnings False
        
    DoCmd.OpenReport "Drops", acViewPreview
    gintProcessStatus = 1

    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
PROC_EXIT:
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    Exit Sub

PROC_ERR:
    MsgBox Err.DESCRIPTION
    Resume PROC_EXIT

End Sub


Private Sub cmdImport_Click()
  ' Comments   :    This is the final import for
  '                 subscribers and dependents
  '                 from the tpa csv file
  ' Parameters :    None
  ' Created    :    2015-10-19  J Criswell
  ' Modified   :
  '
  '
  '
  ' --------------------------------------------------------
  On Error GoTo HandleError
    
    Dim db As DAO.Database
    Dim rst As DAO.Recordset
    Dim intResp As Integer
    Dim strMsg As String
    Dim stDocName As String
    Dim strUserName As String
    
    Set db = CurrentDb()
    
    ' validation
    If ValidSSN And ValidPlanCover Then
            gintProcessStatus = 1
    Else
        If ValidSSN Then
                gintProcessStatus = ValidSSN
        Else
            MsgBox "There are duplicates SSNs in the tpa file."
            gintProcessStatus = ValidPlanCover
        End If
        
        If ValidPlanCover Then
                gintProcessStatus = ValidPlanCover
        Else
            MsgBox "There are incorrect plans and coverages in the tpa file."
            gintProcessStatus = ValidSSN
        End If
    End If
    
    ' validate user running import data
    If gintProcessStatus <> 1 Then
        MsgBox "You're not clear to import data. " & vbCrLf & _
                "Check to see if all issues such as bad " & vbCrLf & _
                "plans and covers and duplicate SSN's " & vbCrLf & _
                "have been addressed. ", vbCritical, _
                "QCD: Data issues"
        gintProcessStatus = 0
        GoTo ExitProc
    End If
    
    strMsg = "Are you ready to begin the final import?"
    
    DoCmd.Hourglass True
    DoCmd.SetWarnings False
                
    '  begin tpa data import into QCD database
    intResp = MsgBox(strMsg, vbQuestion + vbYesNo + vbDefaultButton2, "QCD: tpa import")
    If intResp = vbYes Then
        ' import tpa subscriber data into QCD database
        strUserName = GetCurrentUserName()
        mstrSQL = "usp_tpa_final_sub"
        If Run_Procedure(mstrSQL, strUserName, "", "") Then
            gintProcessStatus = 1
            MsgBox "tpa subscriber data import succeeded.", vbExclamation, "QCD: tpa import"
        Else
            Err.Raise vbObjectError + 513, "usp_tpa_final_sub", "tpa subscriber import failed. Contact support."
            gintProcessStatus = 0
            GoTo HandleError
        End If
        
        ' import tpa dependent data into QCD database
        mstrSQL = "usp_tpa_final_dep"
        If Run_Procedure(mstrSQL, strUserName, "", "") Then
            MsgBox "tpa dependent data import succeeded.", vbExclamation, "QCD: tpa import"
            gintProcessStatus = 1
        Else
            Err.Raise vbObjectError + 513, "usp_tpa_final_dep", "tpa dependent import failed. Contact support."
            gintProcessStatus = 0
            GoTo HandleError
        End If
        
    End If
    ' end of data commit
    
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
        
ExitProc:
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    Exit Sub

HandleError:
  gintProcessStatus = 0
  MsgBox "Error: " & Err.DESCRIPTION & _
     " (" & Err.Number & ")", vbCritical
  Resume ExitProc

End Sub

Private Sub cmdPrint_Click()
    ' Comments   : Prints a report of new subscribers
    ' Parameters : None
    ' Created    : 2/28/2004 1:31:11 PM Admin
    ' Modified   :
    '
    ' --------------------------------------------------------
    On Error GoTo HandleError
    
    ' validation
    If ValidSSN And ValidPlanCover Then
        gintProcessStatus = 1
    Else
        If ValidSSN Then
            gintProcessStatus = ValidSSN
        Else
            gintProcessStatus = 0
        End If
        
        If ValidPlanCover Then
            gintProcessStatus = ValidPlanCover
        Else
            gintProcessStatus = 0
        End If
    End If
    
    ' process data?
    If gintProcessStatus <> 1 Then
        MsgBox "You must process the data first.  Click " & vbCrLf & _
        "'Process Groups' button to process the data! ", vbCritical, _
        "Data Not Processed"
        gintProcessStatus = 0
        GoTo ExitProc
    End If
    
    DoCmd.Hourglass True
    DoCmd.SetWarnings False
    
    'update SQL Server temp table
    ExecuteSQL ("EXEC uspPrintAAreport")
    
    'print preview the report
    DoCmd.OpenReport "rptAA_NewSubscribers", acViewPreview
    
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
ExitProc:
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    Exit Sub
    
HandleError:
    MsgBox "Error: " & Err.DESCRIPTION & _
    " (" & Err.Number & ")", vbExclamation
    Resume ExitProc
End Sub

   
Private Sub cmdProcess_Click()
    
    On Error GoTo PROC_ERR
    
    Dim db As DAO.Database
    Dim rst As DAO.Recordset
    Dim I As Integer
    Dim OutputMeter As Variant
    Dim MeterFull As Integer
    Dim MeterCount As Integer
    Dim stDocName As String
    
    Set db = CurrentDb()
    
    gintProcessStatus = 0
    
    ' warn user about cancelled groups
    Dim Msg, Style, Title, Response
    Msg = "Did you cancel any dropped groups?" & vbCrLf & vbCrLf & _
    "Do you want to continue?"
    Style = vbYesNo + vbInformation + vbDefaultButton2
    Title = "Cancelled groups warning."
    Response = MsgBox(Msg, Style, Title)
    
    If Response = vbYes Then
        
        ' begin importing data into temporary tables
        Msg = "Do you want to import the tpa data?"
        Response = MsgBox(Msg, vbQuestion + vbYesNo + vbDefaultButton2, "QCD: Confirm Action")
        If Response = vbYes Then
            
            Application.SetOption "Show Status Bar", True
            MeterFull = 10
            MeterCount = 1
            DoCmd.Hourglass True
            DoCmd.SetWarnings False
            
            ' process data from tpa file
            mstrSQL = "usp_tpa_import_csv"
            mstrUser = ""
            mstrFileName = PickFile()
            If Not IsNull(mstrFileName) And mstrFileName <> "" Then
                mstrFileName = Mid(mstrFileName, Len(mstrPath) + 1, Len(mstrFileName) - Len(mstrPath))
                mstrPath = mstrPath & "\"
                
                ' Wait 10 seconds while stored procedures run
                MsgBox "Wait while the process completes."
                WaitSeconds (10)
                
                ' import data from tpa file with SSIS package
                I = Run_Procedure(mstrSQL, mstrUser, mstrPath, mstrFileName)
                If I = 1 Then
                    ' split data into subs and deps
                    mstrSQL = "usp_tpa_import_sub"
                    Call GetOutPutParm(mstrSQL)                      ' import subscribers
                    If g_sRtnVal = "Procedure Succeeded" Then
                        mstrSQL = "usp_tpa_import_dep"
                        Call GetOutPutParm(mstrSQL)                  ' import dependents
                        If g_sRtnVal = "Procedure Succeeded" Then
                            gintProcessStatus = 1
                        Else
                            MsgBox "tpa data import failed; contact support.", vbInformation, "QCD: Process tpa data"
                            gintProcessStatus = 0
                            GoTo PROC_EXIT
                        End If
                    End If
                Else
                    MsgBox "The SSIS job failed; contact support.", vbInformation, "QCD: Process tpa data"
                    gintProcessStatus = 0
                    GoTo PROC_EXIT
                End If
            End If
            
            ' validation
            If ValidSSN And ValidPlanCover Then
                gintProcessStatus = 1
            Else
                If ValidSSN Then
                    gintProcessStatus = ValidSSN
                Else
                    MsgBox "There are duplicates SSNs in the tpa file.", vbInformation, "QCD: Process tpa data"
                    gintProcessStatus = ValidPlanCover
                End If
                
                If ValidPlanCover Then
                    gintProcessStatus = ValidPlanCover
                Else
                    MsgBox "There are incorrect plans and coverages in the tpa file.", vbInformation, "QCD: Process tpa data"
                    gintProcessStatus = ValidSSN
                End If
            End If
        End If
    End If
    
    If gintProcessStatus = 1 Then
        MsgBox "File processed correctly.", vbInformation, "QCD: Process tpa data."
    Else
        MsgBox "You have data issues." & vbCrLf & _
        "Correct them with the buttons below" & vbCrLf & _
        "and move on to the import." & vbCrLf & _
        "If you click process again, you must" & vbCrLf & _
        "start from the beginning.", vbCritical, "QCD: Process tpa data."
    End If
    
    Set db = Nothing
    DoCmd.Hourglass False
    DoCmd.SetWarnings True
    OutputMeter = SysCmd(acSysCmdRemoveMeter)
    
PROC_EXIT:
    Set db = Nothing
    DoCmd.Hourglass False
    DoCmd.SetWarnings True
    OutputMeter = SysCmd(acSysCmdRemoveMeter)
    Exit Sub
    

PROC_ERR:
  MsgBox "Error: (" & Err.Number & ") " & Err.DESCRIPTION, vbCritical, "Procedure:fdlgAASync.cmdProcess"
  Resume PROC_EXIT

    
End Sub

Private Sub cmdClose_Click()
On Error GoTo Err_cmdClose_Click


    DoCmd.Close

Exit_cmdClose_Click:
    Exit Sub

Err_cmdClose_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_cmdClose_Click
    
End Sub

Private Sub cmdStatistics_Click()

    On Error GoTo PROC_ERR

    ' validation
    If ValidSSN And ValidPlanCover Then
            gintProcessStatus = 1
    Else
        If ValidSSN Then
            gintProcessStatus = ValidSSN
        Else
            gintProcessStatus = 0
        End If
        
        If ValidPlanCover Then
            gintProcessStatus = ValidPlanCover
        Else
            gintProcessStatus = 0
        End If
    End If
        
    ' process data?
    If gintProcessStatus <> 1 Then
        MsgBox "You must process the data first.  Click " & vbCrLf & _
                "'Process Groups' button to process the data! ", vbCritical, _
                "Data Not Processed"
        gintProcessStatus = 0
        GoTo PROC_EXIT
    End If
    
    DoCmd.SetWarnings False
    DoCmd.Hourglass True
    
    mstrSQL = "usp_tpa_metrics"
    Call GetOutPutParm(mstrSQL)
    If g_sRtnVal = "Procedure Succeeded" Then
        DoCmd.OpenReport "rptAA_Stats", acViewPreview
    Else
        MsgBox "tpa statistics failed.  Contact support.", vbExclamation, "QCD: Statistics"
    End If
    
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
PROC_EXIT:
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    Exit Sub

PROC_ERR:
    gintProcessStatus = 0
    MsgBox Err.DESCRIPTION
    Resume PROC_EXIT

End Sub

Private Sub cmdViewChanges_Click()
    
    On Error GoTo PROC_ERR

    ' validation
    If ValidSSN And ValidPlanCover Then
            gintProcessStatus = 1
    Else
        If ValidSSN Then
            gintProcessStatus = ValidSSN
        Else
            gintProcessStatus = 0
        End If
        
        If ValidPlanCover Then
            gintProcessStatus = ValidPlanCover
        Else
            gintProcessStatus = 0
        End If
    End If
    
    ' process data?
    If gintProcessStatus <> 1 Then
        MsgBox "You must process the data first.  Click " & vbCrLf & _
                "'Process Groups' button to process the data! ", vbCritical, _
                "Data Not Processed"
        gintProcessStatus = 0
        GoTo PROC_EXIT
    End If
    
    DoCmd.OpenReport "rptAA_VarianceReport", acViewPreview
    gintProcessStatus = 1

    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    
PROC_EXIT:
    DoCmd.SetWarnings True
    DoCmd.Hourglass False
    Exit Sub

PROC_ERR:
    gintProcessStatus = 0
    MsgBox Err.DESCRIPTION
    Resume PROC_EXIT
End Sub
Private Sub btnTPA_Bad_Plan_and_Rate_Click()

On Error GoTo Err_btnTPA_Bad_Plan_and_Rate_Click


    Dim db As DAO.Database
    Dim rst As DAO.Recordset
    Dim strSSN() As String
    Dim I As Integer
    Dim J As Integer
    Dim stDocName As String
    Dim strWhere As String
    
    Set db = CurrentDb
    Set rst = db.OpenRecordset("vw_tpa_plan_cover", dbOpenDynaset)
    If rst.BOF And rst.EOF Then
        MsgBox "Plans and covers are correct", vbOKOnly, "QCD: Plans and covers."
        GoTo Exit_btnTPA_Bad_Plan_and_Rate_Click
    Else
        rst.MoveLast
        rst.MoveFirst
        I = 0
        J = rst.RecordCount
        strWhere = "SSN IN ("
        
        ReDim strSSN(I To J)
        If rst.RecordCount > 0 Then
            Do Until rst.EOF
                strSSN(I) = rst("SSN")
                If I <> J - 1 Then
                    strWhere = strWhere & "'" & strSSN(I) & "', "
                Else
                    strWhere = strWhere & "'" & strSSN(I) & "')"
                End If
                I = I + 1
                rst.MoveNext
            Loop
        End If
        stDocName = "frmTPA_Bad_Plan_and_Cover"
        DoCmd.OpenForm stDocName, acFormDS, , strWhere, acFormEdit, acWindowNormal
    End If
    rst.Close
    Set db = Nothing
    
Exit_btnTPA_Bad_Plan_and_Rate_Click:
    'rst.Close
    Set db = Nothing
    Exit Sub

Err_btnTPA_Bad_Plan_and_Rate_Click:
    MsgBox Err.DESCRIPTION
    Resume Exit_btnTPA_Bad_Plan_and_Rate_Click
    
End Sub